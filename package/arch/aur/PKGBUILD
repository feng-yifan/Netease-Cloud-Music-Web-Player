# Maintainer: fengyifan <fengyifan@outlook.com>
pkgname=netease-cloud-music-web-player
pkgver=0.0.1
pkgrel=1
pkgdesc="基于网页播放器封装的网易云音乐客户端"
arch=('x86_64')
url="https://github.com/feng-yifan/$pkgname"
license=('MIT')
depends=('electron33')
makedepends=('npm')
source=("$pkgname-$pkgver.tar.gz::$url/archive/$pkgver.tar.gz")
md5sums=('SKIP')

prepare() {
  cd "$srcdir/$pkgname-$pkgver"
  npm install --no-audit --no-fund
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  # 安装应用文件
  install -dm755 "$pkgdir/usr/lib/$pkgname"
  cp -r --no-preserve=ownership * "$pkgdir/usr/lib/$pkgname/"

  # 创建启动脚本
  install -dm755 "$pkgdir/usr/bin"
  cat > "$pkgdir/usr/bin/$pkgname" << 'EOF'
#!/bin/sh
exec electron /usr/lib/netease-cloud-music-web-player "$@"
EOF
  chmod 755 "$pkgdir/usr/bin/$pkgname"

  # 安装 desktop 文件
  install -dm755 "$pkgdir/usr/share/applications"
  install -m644 "$srcdir/$pkgname-$pkgver/build/$pkgname.desktop" "$pkgdir/usr/share/applications/"

  # 安装图标文件
  install -dm755 "$pkgdir/usr/share/icons/hicolor/384x384/apps"
  install -m644 "$srcdir/$pkgname-$pkgver/build/netease-cloud-music.png" "$pkgdir/usr/share/icons/hicolor/384x384/apps/$pkgname.png"

  install -dm755 "$pkgdir/usr/share/icons/hicolor/scalable/apps"
  install -m644 "$srcdir/$pkgname-$pkgver/build/netease-cloud-music.svg" "$pkgdir/usr/share/icons/hicolor/scalable/apps/$pkgname.svg"
}